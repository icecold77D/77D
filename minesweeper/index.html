<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¸©åœ°é›· Minesweeper</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#9fb2c8; --danger:#ff6b6b;
    --tile:#0e2238;           /* é¢æ¿åº•è‰²ï¼šæé«˜äº®åº¦ */
    --tile-open:#b0c0d4;      /* å·²é–‹æ ¼ */
    --tile-border:#23364d;    /* æ›´æ˜é¡¯çš„é‚Šæ¡†è‰² */
    --tile-size:34px;         /* æœƒç”¨ JS ä¾è¢å¹•å¯¬åº¦æ›´æ–° */
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#071427;color:#e6eef6}

  .container{max-width:980px;margin:22px auto;padding:16px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  .sub{color:var(--muted);font-size:13px}

  /* èªªæ˜ç§»åˆ°æ¨™é¡Œä¸‹æ–¹ï¼Œå¯æ”¶åˆã€å¯æ²å‹• */
  details.guide{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06);
    border-radius:12px; padding:10px 12px; margin:10px 0 14px 0}
  details.guide[open]{box-shadow:0 6px 24px rgba(2,6,23,.35)}
  details.guide summary{cursor:pointer; font-weight:600}
  .guide-body{max-height:140px; overflow:auto; margin-top:6px; color:var(--muted); line-height:1.6}

  /* æ§åˆ¶åˆ—ï¼šæŠŠè‡ªè¨‚/è¡Œ/åˆ—/åœ°é›·æ‹†å››è¡Œ */
  .controls{display:grid;gap:10px;grid-template-columns:1fr; margin:8px 0 12px}
  .controls .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .controls label{min-width:64px;color:var(--muted)}
  select,input,button{
    background:#0d2034;border:1px solid #1d334a;color:#dce8f6;padding:8px 10px;border-radius:10px
  }
  button{background:linear-gradient(180deg,#16455b,#0f3245); cursor:pointer}
  button:hover{transform:translateY(-1px)}

  .status{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .badge{padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);min-width:76px;text-align:center}

  /* æ£‹ç›¤ */
  .board-wrap{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:10px}
  .board{display:grid}
  .tile{
    width:var(--tile-size); height:var(--tile-size);
    display:flex; align-items:center; justify-content:center; margin:3px;
    border-radius:8px; background:linear-gradient(180deg, #142c45, var(--tile));
    border:1px solid var(--tile-border);
    box-shadow: 0 2px 0 rgba(0,0,0,.55),
                0 1px 0 rgba(255,255,255,.06) inset,
                0 0 0 1px rgba(0,0,0,.15) inset;   /* å…§å¤–é›™å±¤ï¼Œè®“é‚Šæ›´æ¸…æ¥š */
    font-weight:700; color:#e8f5ff; user-select:none; cursor:pointer; font-size:14px;
  }
  .tile.open{
    background:linear-gradient(180deg,#123049,var(--tile-open));
    border-color:#2a4762; color:#cfe0f1;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
  }
  .tile.flag{color:var(--accent)}
  .tile.mine{color:#ffd2d2;background:linear-gradient(180deg,#3a1010,#2a0909);border-color:#6b1d1d}
  .tile.number-1{color:#2ea3ff}
  .tile.number-2{color:#28d49c}
  .tile.number-3{color:#ffb36b}
  .tile.number-4{color:#a78bfa}
  .tile.number-5{color:#ff7ab6}
  .tile.number-6{color:#18c5c8}
  .tile.number-7{color:#f59e0b}
  .tile.number-8{color:#c3c7cf}

  /* å°è¢å¹•å„ªåŒ– */
  @media (max-width:640px){
    .container{padding:12px}
    .tile{font-size:13px}
  }
</style>
</head>
<body>
<div class="container" role="main">
  <header>
    <div>
      <h1>è¸©åœ°é›· Â· Minesweeper â€” ç¥ä½ æ‰‹æ°£å¥½ ğŸ€</h1>
      <div class="sub">å·¦éµé–‹æ ¼ï¼å³éµæ¨™æ——ï¼ˆæˆ–æŒ‰ä½ Alt + å·¦éµï¼‰ï¼ç¬¬ä¸€æ¬¡é»æ“Šä¿è­‰å®‰å…¨</div>
    </div>
    <div class="status">
      <div class="badge">å‰©é¤˜ï¼š<span id="mineCount">0</span></div>
      <div class="badge">æ™‚é–“ï¼š<span id="timer">0</span>s</div>
      <button id="resetBtn">é‡ç½®</button>
    </div>
  </header>

  <!-- èªªæ˜ç§»åˆ°æ¨™é¡Œä¸‹æ–¹ï¼Œå¯æ”¶åˆèˆ‡æ²å‹• -->
  <details class="guide" open>
    <summary>ç©æ³•èªªæ˜ï¼ˆé»æˆ‘å±•é–‹/æ”¶åˆï¼‰</summary>
    <div class="guide-body">
      <ul>
        <li>ç¬¬ä¸€æ¬¡é»æ“Šå¾Œæ‰æœƒæ”¾åœ°é›·ï¼Œä¿è­‰å®‰å…¨ä¸‹ç¬¬ä¸€æ­¥ã€‚</li>
        <li>æ•¸å­—ä»£è¡¨å‘¨åœ 8 æ ¼çš„åœ°é›·æ•¸ï¼›ç”¨å³éµï¼ˆæˆ– Alt + å·¦éµï¼‰æ’æ——ã€‚</li>
        <li>æ­é–‹æ‰€æœ‰éåœ°é›·æ ¼å³å‹åˆ©ï¼›è¸©åˆ°åœ°é›·å°±çˆ†ç‚¸å•¦ ğŸ’¥ã€‚</li>
        <li>éµç›¤ï¼šæ–¹å‘éµç§»å‹•ç„¦é»ã€ç©ºç™½éµæ­é–‹ã€F éµæ’æ——ã€‚</li>
      </ul>
    </div>
  </details>

  <!-- æ§åˆ¶å€ï¼šåˆ†å››è¡Œ -->
  <div class="controls" id="controls">
    <div class="row">
      <label>é›£åº¦</label>
      <select id="preset">
        <option value="9x9x10">ç°¡å–® 9Ã—9 Â· 10 åœ°é›·</option>
        <option value="16x16x40">ä¸­ç­‰ 16Ã—16 Â· 40 åœ°é›·</option>
        <option value="16x30x99">å›°é›£ 16Ã—30 Â· 99 åœ°é›·</option>
        <option value="8x12x12">ä¼‘é–’ 8Ã—12 Â· 12 åœ°é›·</option>
      </select>
    </div>
    <div class="row"><label>è‡ªè¨‚</label><span class="sub">ç”±ä¸‹åˆ—ä¸‰é …æ±ºå®šæ£‹ç›¤</span></div>
    <div class="row"><label>è¡Œ</label><input id="rows" type="number" value="9" min="5" max="40" style="width:110px"></div>
    <div class="row"><label>åˆ—</label><input id="cols" type="number" value="9" min="5" max="60" style="width:110px"></div>
    <div class="row"><label>åœ°é›·</label><input id="mines" type="number" value="10" min="1" style="width:110px"></div>
  </div>

  <div class="board-wrap">
    <div id="board" class="board" aria-label="Minesweeper board"></div>
  </div>
</div>

<script>
(() => {
  const boardEl = document.getElementById('board');
  const presetEl = document.getElementById('preset');
  const rowsEl = document.getElementById('rows');
  const colsEl = document.getElementById('cols');
  const minesEl = document.getElementById('mines');
  const resetBtn = document.getElementById('resetBtn');
  const mineCountEl = document.getElementById('mineCount');
  const timerEl = document.getElementById('timer');

  let rows=9, cols=9, totalMines=10;
  let grid=[], firstClick=true, timer=null, elapsed=0, flagsPlaced=0, gameOver=false, cellsToReveal=0;

  const idx = (r,c)=> r*cols + c;
  const inBounds = (r,c)=> r>=0 && r<rows && c>=0 && c<cols;

  function setTileSizeResponsive(){
    // å¯è¦–å¯¬åº¦ï¼ˆæ‰£æ‰å®¹å™¨ padding èˆ‡ tile marginï¼‰
    const container = document.querySelector('.board-wrap');
    const wrapPadding = 20; // å·¦å³åˆè¨ˆå¤§ç´„å€¼ï¼ˆboard-wrap padding 10 + board marginï¼‰
    const vw = Math.min(window.innerWidth, container.clientWidth || window.innerWidth) - wrapPadding;
    // æ¯ä¸€åˆ—æœ‰ cols å€‹æ ¼å­ï¼Œæ ¼å­é–“æœ‰ margin: 3px -> æ¯æ ¼å·¦å³å„ 3pxï¼Œç¸½å…± cols*6
    const gap = cols * 6;
    // é ä¼°å°ºå¯¸ï¼ˆå†åŠ ä¸Šé™åˆ¶ï¼‰
    let size = Math.floor((vw - gap) / cols);
    size = Math.max(24, Math.min(size, 42)); // æ‰‹æ©Ÿä¸å°æ–¼ 24pxï¼Œæ¡Œæ©Ÿä¸å¤§æ–¼ 42pxï¼ˆå¯èª¿ï¼‰
    document.documentElement.style.setProperty('--tile-size', size + 'px');
  }

  function createGrid(){
    grid = new Array(rows*cols);
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        grid[idx(r,c)] = { r,c, mine:false, open:false, flagged:false, adj:0, el:null };
      }
    }
  }

  function placeMinesAvoiding(firstR, firstC){
    const forbidden = new Set();
    for(let dr=-1;dr<=1;dr++){
      for(let dc=-1;dc<=1;dc++){
        const rr = firstR+dr, cc = firstC+dc;
        if(inBounds(rr,cc)) forbidden.add(idx(rr,cc));
      }
    }
    let placed=0, total=rows*cols;
    while(placed<totalMines){
      const pos = Math.floor(Math.random()*total);
      if(forbidden.has(pos)) continue;
      const cell = grid[pos];
      if(!cell.mine){ cell.mine=true; placed++; }
    }
    // è¨ˆç®—é„°é‚Šæ•¸
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = grid[idx(r,c)];
        if(cell.mine){ cell.adj = -1; continue; }
        let cnt=0;
        for(let dr=-1;dr<=1;dr++){
          for(let dc=-1;dc<=1;dc++){
            if(dr===0 && dc===0) continue;
            const rr=r+dr, cc=c+dc;
            if(inBounds(rr,cc) && grid[idx(rr,cc)].mine) cnt++;
          }
        }
        cell.adj = cnt;
      }
    }
  }

  function buildBoard(){
    boardEl.innerHTML='';
    boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--tile-size))`;
    boardEl.style.gridTemplateRows = `repeat(${rows}, var(--tile-size))`;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cell = grid[idx(r,c)];
        const el = document.createElement('div');
        el.className = 'tile';
        el.dataset.r = r; el.dataset.c = c;
        el.setAttribute('role','button');
        el.addEventListener('click', ev => handleLeftClick(ev, cell));
        el.addEventListener('contextmenu', ev => handleRightClick(ev, cell));
        el.addEventListener('auxclick', ev => { if(ev.button===1) handleRightClick(ev, cell); });
        cell.el = el;
        boardEl.appendChild(el);
      }
    }
    setTileSizeResponsive(); // ä¾ç›®å‰ cols è¨­å®šå°ºå¯¸
  }

  function startTimer(){
    if(timer) clearInterval(timer);
    elapsed = 0; timerEl.textContent = '0';
    timer = setInterval(()=>{ elapsed++; timerEl.textContent = elapsed; }, 1000);
  }
  function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

  function revealCell(cell){
    if(cell.open || cell.flagged) return;
    cell.open = true;
    cell.el.classList.add('open');
    if(cell.mine){
      cell.el.classList.add('mine'); cell.el.textContent='ğŸ’£'; return;
    }
    cellsToReveal--;
    if(cell.adj>0){
      cell.el.classList.add('number-'+cell.adj);
      cell.el.textContent = cell.adj;
    }else{
      cell.el.textContent='';
      for(let dr=-1;dr<=1;dr++){
        for(let dc=-1;dc<=1;dc++){
          if(dr===0 && dc===0) continue;
          const rr=cell.r+dr, cc=cell.c+dc;
          if(inBounds(rr,cc)){
            const n=grid[idx(rr,cc)];
            if(!n.open && !n.flagged && !n.mine) revealCell(n);
          }
        }
      }
    }
  }

  function handleLeftClick(ev, cell){
    if(gameOver) return;
    if(ev.altKey) return toggleFlag(cell);
    if(firstClick){
      placeMinesAvoiding(cell.r, cell.c);
      startTimer(); firstClick=false;
    }
    if(cell.flagged || cell.open) return;
    if(cell.mine){ revealAllMines(cell); return endGame(false); }
    revealCell(cell); checkWin();
  }

  function handleRightClick(ev, cell){
    ev.preventDefault();
    if(gameOver || cell.open) return;
    toggleFlag(cell);
  }

  function toggleFlag(cell){
    if(cell.open) return;
    cell.flagged = !cell.flagged;
    cell.el.classList.toggle('flag', cell.flagged);
    cell.el.textContent = cell.flagged ? 'ğŸš©' : '';
    flagsPlaced += cell.flagged ? 1 : -1;
    updateMineCount();
  }

  function revealAllMines(triggerCell){
    for(const c of grid){
      if(c.mine){
        c.el.classList.add('open','mine');
        if(!c.flagged) c.el.textContent = 'ğŸ’£';
      }
      if(c.flagged && !c.mine){
        c.el.textContent='âŒ'; c.el.classList.add('open');
      }
    }
    if(triggerCell) triggerCell.el.classList.add('mine');
  }

  function checkWin(){
    if(cellsToReveal===0 && !gameOver){
      for(const c of grid){ if(c.mine && !c.flagged){ c.flagged=true; c.el.classList.add('flag'); c.el.textContent='ğŸš©'; } }
      endGame(true);
    }
  }

  function endGame(won){
    gameOver = true; stopTimer();
    setTimeout(()=> alert(won ? `ä½ è´äº†ï¼ç”¨æ™‚ ${elapsed} ç§’ ğŸ‰` : 'ä½ è¸©åˆ°åœ°é›·äº† ğŸ’¥ éŠæˆ²çµæŸ'), 40);
  }

  function updateMineCount(){
    mineCountEl.textContent = Math.max(0, totalMines - flagsPlaced);
  }

  function resetGame(){
    rows = +rowsEl.value || 9;
    cols = +colsEl.value || 9;
    totalMines = +minesEl.value || 10;

    const maxM = Math.floor(rows*cols*0.6);
    if(totalMines >= rows*cols){ totalMines = Math.max(1, rows*cols-1); minesEl.value = totalMines; }
    if(totalMines > maxM){ totalMines = maxM; minesEl.value = totalMines; }

    firstClick=true; gameOver=false; flagsPlaced=0; stopTimer();
    timerEl.textContent='0'; mineCountEl.textContent=totalMines;
    cellsToReveal = rows*cols - totalMines;

    createGrid(); buildBoard();

    // è®“éµç›¤å¯å¾ç¬¬ä¸€æ ¼é–‹å§‹
    const firstTile = boardEl.querySelector('.tile');
    if(firstTile){ firstTile.tabIndex = 0; }
  }

  // é›£åº¦é¸å–®
  presetEl.addEventListener('change', ()=>{
    const v = presetEl.value.split('x').map(Number);
    if(v.length===3){ rowsEl.value=v[0]; colsEl.value=v[1]; minesEl.value=v[2]; resetGame(); }
  });

  // è‡ªè¨‚ä¸‰é …ä»»ä½•è®Šå‹•å°±é‡ç½®
  [rowsEl, colsEl, minesEl].forEach(el=> el.addEventListener('change', ()=>{ presetEl.value=''; resetGame(); }));

  // é‡ç½® & è¦–çª—å°ºå¯¸è®ŠåŒ– â†’ é‡æ–°è¨ˆç®— tile å¤§å°
  resetBtn.addEventListener('click', resetGame);
  window.addEventListener('resize', setTileSizeResponsive);
  window.addEventListener('orientationchange', setTileSizeResponsive);

  // å•Ÿå‹•
  resetGame();

  // å°å¤–ï¼ˆdebugï¼‰
  window._ms = { resetGame, setTileSizeResponsive };
})();
</script>
</body>
</html>
