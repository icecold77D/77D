<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¸©åœ°é›· Minesweeper</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#9fb2c8; --danger:#ff6b6b;
    --tile:#d3d7de;           /* æ·ºç°èƒŒæ™¯ */
    --tile-open:#f0f2f5;      /* é–‹å•Ÿå¾Œæ›´äº® */
    --tile-border:#8a8f99;    /* æ·±ç°é‚Šæ¡† */
    --tile-size:34px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#071427;color:#1a1d21}

  .container{max-width:960px;margin:20px auto;padding:14px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  .sub{color:var(--muted);font-size:13px}

  .controls{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0 14px}
  .controls label{font-weight:600}
  select,input,button{
    background:#fff;border:1px solid #ccc;color:#222;padding:6px 8px;border-radius:8px
  }
  button{background:#0e344b;color:#fff;cursor:pointer}
  button:hover{background:#11546b}

  .status{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .badge{padding:6px 10px;border-radius:8px;background:#e5e7eb;border:1px solid #cbd5e1;min-width:76px;text-align:center}

  .board-wrap{background:#fafafa;border:1px solid #ddd;border-radius:12px;padding:10px}
  .board{display:grid}
  .tile{
    width:var(--tile-size); height:var(--tile-size);
    display:flex; align-items:center; justify-content:center; margin:2px;
    border-radius:6px; background:var(--tile);
    border:1px solid var(--tile-border);
    font-weight:700; color:#1f2937; user-select:none; cursor:pointer; font-size:14px;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.5);
  }
  .tile.open{background:var(--tile-open);border-color:#a0a0a0;color:#111}
  .tile.flag{color:var(--accent)}
  .tile.mine{color:#c00;background:#f2b1b1;border-color:#a33}
  .tile.number-1{color:#1d4ed8}
  .tile.number-2{color:#15803d}
  .tile.number-3{color:#be123c}
  .tile.number-4{color:#7e22ce}
  .tile.number-5{color:#c2410c}
  .tile.number-6{color:#0891b2}
  .tile.number-7{color:#78350f}
  .tile.number-8{color:#374151}

  details.guide{background:#f3f4f6;border:1px solid #d1d5db;
    border-radius:10px; padding:10px 12px; margin:14px 0}
  details.guide summary{cursor:pointer;font-weight:600}
  .guide-body{margin-top:6px;color:#374151;line-height:1.6;font-size:14px}
</style>
</head>
<body>
<div class="container" role="main">
  <header>
    <div>
      <h1>è¸©åœ°é›· Â· Minesweeper</h1>
      <div class="sub">å·¦éµé–‹æ ¼ï¼å³éµæ¨™æ——ï¼ˆæˆ–æŒ‰ Alt+å·¦éµï¼‰ï¼ç¬¬ä¸€æ¬¡é»æ“Šå®‰å…¨</div>
    </div>
    <div class="status">
      <div class="badge">å‰©é¤˜ï¼š<span id="mineCount">0</span></div>
      <div class="badge">æ™‚é–“ï¼š<span id="timer">0</span>s</div>
      <button id="resetBtn">é‡ç½®</button>
    </div>
  </header>

  <!-- æ§åˆ¶å€ï¼šè¡Œã€åˆ—ã€åœ°é›·åŒæ’ -->
  <div class="controls">
    <label>é›£åº¦
      <select id="preset">
        <option value="9x9x10">ç°¡å–® 9Ã—9 Â· 10</option>
        <option value="16x16x40">ä¸­ç­‰ 16Ã—16 Â· 40</option>
        <option value="16x30x99">å›°é›£ 16Ã—30 Â· 99</option>
        <option value="8x12x12">ä¼‘é–’ 8Ã—12 Â· 12</option>
      </select>
    </label>
    <label>è¡Œ <input id="rows" type="number" value="9" min="5" max="40" style="width:64px"></label>
    <label>åˆ— <input id="cols" type="number" value="9" min="5" max="60" style="width:64px"></label>
    <label>åœ°é›· <input id="mines" type="number" value="10" min="1" style="width:80px"></label>
  </div>

  <div class="board-wrap">
    <div id="board" class="board" aria-label="Minesweeper board"></div>
  </div>

  <!-- èªªæ˜æ”¾åœ¨éŠæˆ²æ–¹æ ¼ä¸‹ -->
  <details class="guide" open>
    <summary>ç©æ³•èªªæ˜</summary>
    <div class="guide-body">
      <ul>
        <li>ç¬¬ä¸€æ¬¡é»æ“Šå¾Œæ‰æœƒæ”¾åœ°é›·ï¼Œä¿è­‰å®‰å…¨ã€‚</li>
        <li>æ•¸å­—é¡¯ç¤ºå‘¨åœ 8 æ ¼çš„åœ°é›·æ•¸ã€‚</li>
        <li>å³éµï¼ˆæˆ– Alt+å·¦éµï¼‰æ’æ——ã€‚</li>
        <li>æ­é–‹æ‰€æœ‰éåœ°é›·æ ¼å­å°±ç²å‹ã€‚</li>
      </ul>
    </div>
  </details>
</div>

<script>
/* === JS (åŒå‰ç‰ˆæœ¬ï¼Œçœç•¥ä¸å‹•çš„ç¨‹å¼ç¢¼ï¼Œç…§æ¬å³å¯) === */
(() => {
  const boardEl=document.getElementById('board');
  const presetEl=document.getElementById('preset');
  const rowsEl=document.getElementById('rows');
  const colsEl=document.getElementById('cols');
  const minesEl=document.getElementById('mines');
  const resetBtn=document.getElementById('resetBtn');
  const mineCountEl=document.getElementById('mineCount');
  const timerEl=document.getElementById('timer');
  let rows=9,cols=9,totalMines=10,grid=[],firstClick=true,timer=null,elapsed=0,flagsPlaced=0,gameOver=false,cellsToReveal=0;
  const idx=(r,c)=>r*cols+c;
  const inBounds=(r,c)=>r>=0&&r<rows&&c>=0&&c<cols;
  function createGrid(){grid=new Array(rows*cols);for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){grid[idx(r,c)]={r,c,mine:false,open:false,flagged:false,adj:0,el:null};}}}
  function placeMinesAvoiding(firstR,firstC){const forbidden=new Set();for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){const rr=firstR+dr,cc=firstC+dc;if(inBounds(rr,cc))forbidden.add(idx(rr,cc));}}let placed=0,total=rows*cols;while(placed<totalMines){const pos=Math.floor(Math.random()*total);if(forbidden.has(pos))continue;const cell=grid[pos];if(!cell.mine){cell.mine=true;placed++;}}for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){const cell=grid[idx(r,c)];if(cell.mine){cell.adj=-1;continue;}let cnt=0;for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){if(dr===0&&dc===0)continue;const rr=r+dr,cc=c+dc;if(inBounds(rr,cc)&&grid[idx(rr,cc)].mine)cnt++;}}cell.adj=cnt;}}}
  function buildBoard(){boardEl.innerHTML='';boardEl.style.gridTemplateColumns=`repeat(${cols}, var(--tile-size))`;boardEl.style.gridTemplateRows=`repeat(${rows}, var(--tile-size))`;for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){const cell=grid[idx(r,c)];const el=document.createElement('div');el.className='tile';el.dataset.r=r;el.dataset.c=c;el.addEventListener('click',ev=>handleLeftClick(ev,cell));el.addEventListener('contextmenu',ev=>handleRightClick(ev,cell));el.addEventListener('auxclick',ev=>{if(ev.button===1)handleRightClick(ev,cell);});cell.el=el;boardEl.appendChild(el);}}}
  function startTimer(){if(timer)clearInterval(timer);elapsed=0;timerEl.textContent='0';timer=setInterval(()=>{elapsed++;timerEl.textContent=elapsed;},1000);}
  function stopTimer(){if(timer){clearInterval(timer);timer=null;}}
  function revealCell(cell){if(cell.open||cell.flagged)return;cell.open=true;cell.el.classList.add('open');if(cell.mine){cell.el.classList.add('mine');cell.el.textContent='ğŸ’£';return;}cellsToReveal--;if(cell.adj>0){cell.el.classList.add('number-'+cell.adj);cell.el.textContent=cell.adj;}else{cell.el.textContent='';for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){if(dr===0&&dc===0)continue;const rr=cell.r+dr,cc=cell.c+dc;if(inBounds(rr,cc)){const n=grid[idx(rr,cc)];if(!n.open&&!n.flagged&&!n.mine)revealCell(n);}}}}}
  function handleLeftClick(ev,cell){if(gameOver)return;if(ev.altKey)return toggleFlag(cell);if(firstClick){placeMinesAvoiding(cell.r,cell.c);startTimer();firstClick=false;}if(cell.flagged||cell.open)return;if(cell.mine){revealAllMines(cell);return endGame(false);}revealCell(cell);checkWin();}
  function handleRightClick(ev,cell){ev.preventDefault();if(gameOver||cell.open)return;toggleFlag(cell);}
  function toggleFlag(cell){if(cell.open)return;cell.flagged=!cell.flagged;cell.el.classList.toggle('flag',cell.flagged);cell.el.textContent=cell.flagged?'ğŸš©':'';flagsPlaced+=cell.flagged?1:-1;updateMineCount();}
  function revealAllMines(triggerCell){for(const c of grid){if(c.mine){c.el.classList.add('open','mine');if(!c.flagged)c.el.textContent='ğŸ’£';}if(c.flagged&&!c.mine){c.el.textContent='âŒ';c.el.classList.add('open');}}if(triggerCell)triggerCell.el.classList.add('mine');}
  function checkWin(){if(cellsToReveal===0&&!gameOver){for(const c of grid){if(c.mine&&!c.flagged){c.flagged=true;c.el.classList.add('flag');c.el.textContent='ğŸš©';}}endGame(true);}}
  function endGame(won){gameOver=true;stopTimer();setTimeout(()=>alert(won?`ä½ è´äº†ï¼ç”¨æ™‚ ${elapsed} ç§’ ğŸ‰`:'ä½ è¸©åˆ°åœ°é›·äº† ğŸ’¥'),40);}
  function updateMineCount(){mineCountEl.textContent=Math.max(0,totalMines-flagsPlaced);}
  function resetGame(){rows=+rowsEl.value||9;cols=+colsEl.value||9;totalMines=+minesEl.value||10;const maxM=Math.floor(rows*cols*0.6);if(totalMines>=rows*cols){totalMines=Math.max(1,rows*cols-1);minesEl.value=totalMines;}if(totalMines>maxM){totalMines=maxM;minesEl.value=totalMines;}firstClick=true;gameOver=false;flagsPlaced=0;stopTimer();timerEl.textContent='0';mineCountEl.textContent=totalMines;cellsToReveal=rows*cols-totalMines;createGrid();buildBoard();}
  presetEl.addEventListener('change',()=>{const v=presetEl.value.split('x').map(Number);if(v.length===3){rowsEl.value=v[0];colsEl.value=v[1];minesEl.value=v[2];resetGame();}});
  [rowsEl,colsEl,minesEl].forEach(el=>el.addEventListener('change',()=>{presetEl.value='';resetGame();}));
  resetBtn.addEventListener('click',resetGame);
  resetGame();
})();
</script>
</body>
</html>
