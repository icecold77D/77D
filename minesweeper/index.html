<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>è¸©åœ°é›· Minesweeper</title>
<style>
  :root{
    --tile:#d7dbe2; --tile-open:#f3f5f8; --tile-border:#8a919d;
    --tile-size:34px; --board-side:520px;
    --ink:#0f1720; --bg:#0c1424; --panel:#fafafa; --panel-border:#d9dde6; --accent:#0ea5a3;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  .container{max-width:980px;margin:16px auto;padding:12px}

  header{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
  h1{margin:0;font-size:20px;color:#e6f1ff} /* å°ä¸€è™Ÿ */

  /* ç¬¬ä¸€æ’ï¼šä¸æ›è¡Œï¼ˆçª„è¢å¹•å¯å·¦å³æ»‘ï¼‰ */
  .bar{
    display:flex; gap:10px; align-items:center; margin:12px 0 8px;
    flex-wrap:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:thin;
  }
  .bar > *{flex:0 0 auto} /* å¼·åˆ¶å–®è¡Œ */
  .bar label{font-weight:700;color:#e6f1ff}

  .badge{padding:5px 5px;border-radius:5px;background:#e5e7eb;border:1px solid #cbd5e1;min-width:60px;text-align:center}
  select,input,button{background:#fff;border:1px solid #cbd5e1;color:var(--ink);padding:8px 10px;border-radius:10px}
  button{background:#0e344b;color:#fff;border-color:#0e344b;cursor:pointer}
  button:hover{filter:brightness(1.07)}

  /* ç¬¬äºŒæ’ï¼šè¡Œ/åˆ—/åœ°é›· */
  .triplet{
  display:flex; gap:12px; align-items:center;
  flex-wrap:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:thin;
  }
  .triplet > *{ flex:0 0 auto; } /* æ¯å€‹é …ç›®å›ºå®šå¯¬ï¼Œé¿å…è¢«æ“ æ›è¡Œ */

  .field{display:flex;gap:60px;align-items:center}
  .field label{font-weight:1000;color:#e6f1ff}
  .field input{width:6px}

  /* æ£‹ç›¤å¤–æ¡†ï¼šç½®ä¸­ + æ­£æ–¹å½¢ */
  .board-shell{
    margin:0 auto; width:var(--board-side); height:var(--board-side);
    background:var(--panel); border:1px solid var(--panel-border); border-radius:14px; padding:10px;
    display:flex; align-items:center; justify-content:center;
  }
  .board{display:grid}

  .tile{
    width:var(--tile-size); height:var(--tile-size);
    display:flex; align-items:center; justify-content:center; margin:2px;
    border-radius:8px; background:var(--tile); border:1px solid var(--tile-border);
    font-weight:800; color:#111827; font-size:14px; user-select:none; cursor:pointer;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.55); touch-action:manipulation;
  }
  .tile.open{background:var(--tile-open);border-color:#a3a9b3;color:var(--ink)}
  .tile.flag{color:var(--accent)}
  .tile.mine{color:#b91c1c;background:#f2b1b1;border-color:#9f1b1b}
  .tile.number-1{color:#1d4ed8}.tile.number-2{color:#15803d}.tile.number-3{color:#be123c}
  .tile.number-4{color:#7e22ce}.tile.number-5{color:#c2410c}.tile.number-6{color:#0891b2}
  .tile.number-7{color:#78350f}.tile.number-8{color:#374151}

  details.guide{background:#0f1a30;border:1px solid #1e2a44;border-radius:12px;padding:10px 12px;margin:14px 0}
  details.guide summary{cursor:pointer;color:#e6f1ff;font-weight:800}
  .guide-body{margin-top:6px;color:#c8d4e3;line-height:1.7}
  .kbd{display:inline-block;padding:2px 6px;border:1px solid #cbd5e1;border-radius:6px;background:#f8fafc;color:#111827;font-size:12px}
  @media (max-width:640px){ .field input{width:84px} }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>è¸©åœ°é›· Â· Minesweeper â€” ç¥ä½ æ‰‹æ°£å¥½ ğŸ€</h1>
  </header>

  <!-- ç¬¬ä¸€æ’ï¼ˆå–®è¡Œã€å¯æ©«å‘æ²å‹•ï¼‰ -->
  <div class="bar">
    <label for="preset">é›£æ˜“åº¦
      <select id="preset">
        <option value="9x9x10">ç°¡å–® 9Ã—9 Â· 10</option>
        <option value="12x12x30">ä¸­ç­‰ 12Ã—12 Â· 30</option>
        <option value="16x16x99">å›°é›£ 16Ã—16 Â· 99</option>
        <option value="8x8x5">ä¼‘é–’ 8Ã—8 Â· 5</option>
      </select>
    </label>
    <div class="badge">å‰©é¤˜ï¼š<span id="mineCount">0</span></div>
    <div class="badge">æ™‚é–“ï¼š<span id="timer">0</span>s</div>
  </div>

  <!-- ç¬¬äºŒæ’ -->
  <div class="triplet">
    <div class="field"><label for="rows">è¡Œ</label><input id="rows" type="number" value="9" min="5" max="60"></div>
    <div class="field"><label for="cols">åˆ—</label><input id="cols" type="number" value="9" min="5" max="80"></div>
    <div class="field"><label for="mines">åœ°é›·</label><input id="mines" type="number" value="10" min="1"></div>
    <button id="resetBtn">é‡ç½®</button>
  </div>

  <div class="board-shell">
    <div id="board" class="board" aria-label="Minesweeper board"></div>
  </div>

  <details class="guide">
    <summary>ç©æ³•èªªæ˜ / æ“ä½œæç¤ºï¼ˆé»æˆ‘å±•é–‹/æ”¶åˆï¼‰</summary>
    <div class="guide-body">
      <p><strong>é›»è…¦ç‰ˆï¼š</strong> å·¦éµé–‹æ ¼ï¼›å³éµæ’æ——ï¼›<span class="kbd">F</span> æ’æ——ï¼›<span class="kbd">Space</span> é–‹æ ¼ï¼›æ–¹å‘éµç§»å‹•ç„¦é»ã€‚</p>
      <p><strong>æ‰‹æ©Ÿç‰ˆï¼š</strong> è¼•é»é–‹æ ¼ï¼›<em>é•·æŒ‰ 350ms</em> æ’æ——ï¼›æˆ–æŒ‰ä½ <span class="kbd">Alt</span> + é»æ“Šã€‚</p>
      <ul>
        <li>ç¬¬ä¸€æ¬¡é»æ“Šå¾Œæ‰æœƒæ”¾åœ°é›·ï¼Œä¿è­‰å®‰å…¨ã€‚</li>
        <li>æ•¸å­—ç‚ºå‘¨åœ 8 æ ¼çš„åœ°é›·æ•¸ï¼›æ­é–‹æ‰€æœ‰éåœ°é›·æ ¼å³å‹åˆ©ã€‚</li>
      </ul>
    </div>
  </details>
</div>

<script>
(() => {
  const boardEl=document.getElementById('board');
  const presetEl=document.getElementById('preset');
  const rowsEl=document.getElementById('rows');
  const colsEl=document.getElementById('cols');
  const minesEl=document.getElementById('mines');
  const resetBtn=document.getElementById('resetBtn');
  const mineCountEl=document.getElementById('mineCount');
  const timerEl=document.getElementById('timer');
  const containerEl=document.querySelector('.container');

  let rows=9, cols=9, totalMines=10;
  let grid=[], firstClick=true, timer=null, elapsed=0, flagsPlaced=0, gameOver=false, cellsToReveal=0;

  const idx=(r,c)=>r*cols+c;
  const inBounds=(r,c)=>r>=0&&r<rows&&c>=0&&c<cols;

  function layoutBoardSquare(){
    const maxWidth = containerEl.clientWidth;
    const safeTop = document.querySelector('header').offsetHeight
                  + document.querySelector('.bar').offsetHeight
                  + document.querySelector('.triplet').offsetHeight + 28;
    const maxHeight = Math.max(260, window.innerHeight - safeTop - 170);
    const side = Math.floor(Math.min(maxWidth, maxHeight));
    document.documentElement.style.setProperty('--board-side', side + 'px');

    const inner = side - 20;          // shell padding 10*2
    const totalGaps = cols * 4;       // æ¯æ ¼å·¦å³ margin 2+2
    let size = Math.floor((inner - totalGaps) / cols);
    size = Math.max(20, Math.min(size, 54));
    document.documentElement.style.setProperty('--tile-size', size + 'px');

    boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--tile-size))`;
    boardEl.style.gridTemplateRows    = `repeat(${rows}, var(--tile-size))`;
  }

  function createGrid(){
    grid=new Array(rows*cols);
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)
      grid[idx(r,c)]={r,c,mine:false,open:false,flagged:false,adj:0,el:null};
  }

  function placeMinesAvoiding(firstR,firstC){
    const forbidden=new Set();
    for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
      const rr=firstR+dr,cc=firstC+dc; if(inBounds(rr,cc)) forbidden.add(idx(rr,cc));
    }
    let placed=0,total=rows*cols;
    while(placed<totalMines){
      const pos=Math.floor(Math.random()*total);
      if(forbidden.has(pos)) continue;
      const cell=grid[pos]; if(!cell.mine){ cell.mine=true; placed++; }
    }
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
      const cell=grid[idx(r,c)]; if(cell.mine){ cell.adj=-1; continue; }
      let cnt=0;
      for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
        if(dr===0&&dc===0) continue;
        const rr=r+dr,cc=c+dc;
        if(inBounds(rr,cc)&&grid[idx(rr,cc)].mine) cnt++;
      }
      cell.adj=cnt;
    }
  }

  function buildBoard(){
    boardEl.innerHTML='';
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
      const cell=grid[idx(r,c)];
      const el=document.createElement('div');
      el.className='tile'; el.dataset.r=r; el.dataset.c=c;
      el.addEventListener('click', ev=>handleLeftClick(ev,cell));
      el.addEventListener('contextmenu', ev=>handleRightClick(ev,cell));
      el.addEventListener('auxclick', ev=>{ if(ev.button===1) handleRightClick(ev,cell); });
      // æ‰‹æ©Ÿé•·æŒ‰æ’æ——
      let tId=null, pressed=false;
      el.addEventListener('touchstart', ()=>{ pressed=true; tId=setTimeout(()=>{ if(pressed&&!cell.open) toggleFlag(cell); },350); }, {passive:true});
      el.addEventListener('touchend', ()=>{ pressed=false; if(tId) clearTimeout(tId); }, {passive:true});
      el.addEventListener('touchmove', ()=>{ pressed=false; if(tId) clearTimeout(tId); }, {passive:true});
      cell.el=el; boardEl.appendChild(el);
    }
    layoutBoardSquare();
  }

  function startTimer(){ if(timer) clearInterval(timer); elapsed=0; timerEl.textContent='0';
    timer=setInterval(()=>{ elapsed++; timerEl.textContent=elapsed; },1000); }
  function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

  function revealCell(cell){
    if(cell.open||cell.flagged) return;
    cell.open=true; cell.el.classList.add('open');
    if(cell.mine){ cell.el.classList.add('mine'); cell.el.textContent='ğŸ’£'; return; }
    cellsToReveal--;
    if(cell.adj>0){ cell.el.classList.add('number-'+cell.adj); cell.el.textContent=cell.adj; }
    else{
      for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
        if(dr===0&&dc===0) continue;
        const rr=cell.r+dr,cc=cell.c+dc;
        if(inBounds(rr,cc)){ const n=grid[idx(rr,cc)];
          if(!n.open && !n.flagged && !n.mine) revealCell(n);
        }
      }
    }
  }

  function handleLeftClick(ev,cell){
    if(gameOver) return;
    if(ev && ev.altKey) return toggleFlag(cell);
    if(firstClick){ placeMinesAvoiding(cell.r,cell.c); startTimer(); firstClick=false; }
    if(cell.flagged||cell.open) return;
    if(cell.mine){ revealAllMines(cell); return endGame(false); }
    revealCell(cell); checkWin();
  }
  function handleRightClick(ev,cell){ ev.preventDefault(); if(gameOver||cell.open) return; toggleFlag(cell); }

  function toggleFlag(cell){
    if(cell.open) return;
    cell.flagged=!cell.flagged;
    cell.el.classList.toggle('flag',cell.flagged);
    cell.el.textContent=cell.flagged?'ğŸš©':'';
    flagsPlaced+=cell.flagged?1:-1; updateMineCount();
  }

  function revealAllMines(triggerCell){
    for(const c of grid){
      if(c.mine){ c.el.classList.add('open','mine'); if(!c.flagged) c.el.textContent='ğŸ’£'; }
      if(c.flagged && !c.mine){ c.el.textContent='âŒ'; c.el.classList.add('open'); }
    }
    if(triggerCell) triggerCell.el.classList.add('mine');
  }

  function checkWin(){
    if(cellsToReveal===0 && !gameOver){
      for(const c of grid){ if(c.mine && !c.flagged){ c.flagged=true; c.el.classList.add('flag'); c.el.textContent='ğŸš©'; } }
      endGame(true);
    }
  }

  function endGame(won){ gameOver=true; stopTimer();
    setTimeout(()=>alert(won?`ä½ è´äº†ï¼ç”¨æ™‚ ${elapsed} ç§’ ğŸ‰`:'ä½ è¸©åˆ°åœ°é›·äº† ğŸ’¥ éŠæˆ²çµæŸ'),50); }

  function updateMineCount(){ mineCountEl.textContent=Math.max(0,totalMines-flagsPlaced); }

  function resetGame(){
    rows=+rowsEl.value||9; cols=+colsEl.value||9; totalMines=+minesEl.value||10;
    const maxM=Math.floor(rows*cols*0.6);
    if(totalMines>=rows*cols){ totalMines=Math.max(1,rows*cols-1); minesEl.value=totalMines; }
    if(totalMines>maxM){ totalMines=maxM; minesEl.value=totalMines; }
    firstClick=true; gameOver=false; flagsPlaced=0; stopTimer();
    timerEl.textContent='0'; mineCountEl.textContent=totalMines;
    cellsToReveal=rows*cols-totalMines;
    createGrid(); buildBoard();
  }

  presetEl.addEventListener('change', ()=>{
    const v=presetEl.value.split('x').map(Number);
    if(v.length===3){ rowsEl.value=v[0]; colsEl.value=v[1]; minesEl.value=v[2]; resetGame(); }
  });
  [rowsEl,colsEl,minesEl].forEach(el=>el.addEventListener('change',()=>{ presetEl.value=''; resetGame(); }));
  resetBtn.addEventListener('click', resetGame);
  window.addEventListener('resize', layoutBoardSquare);
  window.addEventListener('orientationchange', layoutBoardSquare);

  resetGame();
})();
</script>
</body>
</html>
